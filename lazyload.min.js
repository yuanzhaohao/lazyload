(function(t,e){if(typeof define==="function"&&define.amd){define([],e)}else if(typeof exports==="object"){module.exports=e()}else{t.Lazyload=e()}})(this,function(){var t=window,e=document,n=0,r=function(){};var i=function(t,e){var n={};var r=Array.prototype,i=Object.prototype,o=Function.prototype;var a=r.slice,u=i.toString,l=i.hasOwnProperty;var f=Object.keys,s=Array.isArray;n.isObject=function(t){var e=typeof t;return e==="function"||e==="object"&&!!t};n.isElement=function(t){return!!(t&&t.nodeType===1)};n.isArray=s||function(t){return u.call(t)==="[object Array]"};n.has=function(t,e){return t!=null&&l.call(t,e)};n.keys=function(t){if(!n.isObject){return[]}if(f){f(t)}var e=[];for(var r in t){if(n.has(t,r)){e.push(r)}}return e};n.extend=function(t,e){if(!e){return t}var r=n.keys(t),i=r.length,o;while(i--){o=r[i];if(e[o]!==undefined){t[o]=e[o]}}return t};n.each=function(t,e,r){var i,o;if(n.isArray(t)){for(i=0,o=t.length;i<o;i++){e.call(r,t[i],i,t)}}else{var a=n.keys(t);for(i=0,o=a.length;i<o;i++){e.call(r,t[a[i]],a[i],t)}}return t};n.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(t){n["is"+t]=function(e){return u.call(e)==="[object "+t+"]"}});n.isEmpty=function(t){if(t==null){return true}if(n.isArray(t)||n.isString(t)){return t.length===0}return n.keys(t).length===0};n.filter=function(t,e,r){var i=[];n.each(t,function(t,n,o){if(e.call(r,t,n,o)){i.push(t)}});return i};n.now=Date.now||function(){return(new Date).getTime()};n.later=function(t,e,n,r){var i=a.call(r),o=function(){t.apply(n,r)},u=setTimeout(o,e);return{id:u,cancel:function(){clearTimeout(u)}}};n.buffer=function(t,e,r){var i=null;e=e||150;if(n.isString(t)){t=r[t]}function o(){o.stop();i=n.later(t,e,r,arguments)}o.stop=function(){if(i){i.cancel();i=0}};return o};n.throttle=function(t,e,r){var i=0,o=0,a=null;e=e||150;if(n.isString(t)){t=r[t]}function u(){u.stop();i=n.now();t.apply(r||this,arguments);o=n.now()}u.stop=function(){if(a){a.cancel();a=0}};return function(){if(!i||o>=i&&n.now()-o>e||o<i&&S.now()-i>e*8){u()}else{if(a){a.cancel()}a=n.later(u,e,r,arguments)}}};return n}(window,document,undefined);function o(t){var n=t,r=0,i=0;while(n!=null&&n!=e){r+=n.offsetLeft;i+=n.offsetTop;n=n.offsetParent}return{left:r,top:i}}function a(t){return this instanceof a?this._init.call(this,t):new a(t)}a.prototype={constructor:a,_init:function(t){var e=this;var n={element:document,attribute:"data-lazyload",diff:100,autoDestroy:true,duration:300,onStart:null};e.element=e._getElement(t.element);e.attribute=i.isString(t.attribute)?t.attribute:n.attribute;e.diff=t.diff===undefined?n.diff:t.diff;e.autoDestroy=t.autoDestroy===undefined?n.autoDestroy:t.autoDestroy;e.duration=i.isNumber(t.duration)&&t.duration>0?t.duration:n.duration;e.onStart=i.isFunction(t.onStart)?t.onStart:n.onStart;e.diff=e._getBoundingRect();e._elementIsNotDocument=e.element.nodeType!=9;e._callbacks={};e._startLis=[];e._initLoadEvent();e.addElements(e.element);e._loadFn();e.resume();e._init=null},_initLoadEvent:function(){var t=this,e=t.autoDestroy,n=t.duration,r=t.attribute;t.imgHandle=function(){var e=this,n={elem:e,src:e.getAttribute(r)};t.onStart&&t.onStart(n);if(e.src!=n.src){e.src=n.src}e.removeAttribute(r)};t._loadFn=i.throttle(function(){if(e&&i.isEmpty(t._callbacks)){t.destroy()}t._loadItems()},n,t)},_getElement:function(n){var r=this;if(n===t){n=e}if(i.isElement(n)){if(n.nodeName==="BODY"){n=e}}else if(i.isString(n)){n=e.querySelector(n)}return n||e},_getBoundingRect:function(){var t=this,e=t.diff;if(!i.isObject(e)){e={top:e,right:e,bottom:e,left:e}}return e},_loadItems:function(){var t=this,e=t.element;if(t._elementIsNotDocument&&!e.offsetWidth){return}i.each(t._callbacks,function(e,n){e&&t._loadItem(n,e)})},_loadItem:function(t,e){var n=this,e=e||n._callbacks[t];if(!e){return true}var r=e.el,i=e.fn,o=false;if(n.__inViewport(r)){try{o=i.call(r)}catch(a){setTimeout(function(){throw a},0)}}if(o!==false){delete n._callbacks[t]}return o},__inViewport:function(e){var n=this,r=!n._elementIsNotDocument,i=o(e),a=n.diff,u,l,f,s;if(r){var c=t.innerWidth,d=t.innerHeight,m=t.scrollX,v=t.scrollY;f=d+v<=i.top-a.bottom;l=c+m<=i.left-a.right;u=v>=i.top+e.offsetHeight+a.top;s=m>i.left+e.offsetWidth+a.left}return!u&&!l&&!f&&!s},addCallback:function(t,o){if(!i.isElement(t)){return}var a=this,u=a._callbacks,l={el:t||e,fn:o||r},f=++n;u[f]=l;a._loadItem(f,l);return f},removeCallback:function(t,e){if(!i.isElement(t)){return}var n=this,r=n._callbacks;i.each(r,function(n,i){if(t==n.el&&(e?e==n.fn:1)){delete r[i]}})},addElements:function(t){var n=this,r=n.attribute;if(i.isString(t)){t=e.querySelectorAll(t)}else if(!i.isArray(t)){t=[t]}i.each(t,function(t,e){if(!t){return}var o=[];i.each(t.querySelectorAll("img"),function(t){o.push(t)});i.each(i.filter([t].concat(o),function(t){return t.getAttribute&&t.getAttribute(r)},n),function(t){var e=n.addCallback(t,n.imgHandle)})})},resume:function(){var e=this,n=e._loadFn;if(e._destroyed){return}t.addEventListener("scroll",n,false);t.addEventListener("touchmove",n,false);t.addEventListener("resize",n,false);if(e._elementIsNotDocument){e.element.addEventListener("scroll",n,false);e.element.addEventListener("touchmove",n,false)}},pause:function(){var e=this,n=e._loadFn;if(e._destroyed){return}t.removeEventListener("scroll",n,false);t.removeEventListener("touchmove",n,false);t.removeEventListener("resize",n,false);if(e._elementIsNotDocument){e.element.removeEventListener("scroll",n,false);e.element.removeEventListener("touchmove",n,false)}},destroy:function(){var t=this;t.pause();t._callbacks={};t._destroyed=1},refresh:function(){this._loadFn()}};return a});