"use strict";!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.Lazyload=e()}(this,function(){function t(t){var e=c.scrollLeft(),n=c.scrollTop();if(t.getBoundingClientRect){var r=t.getBoundingClientRect(),o=document,i=o.body,a=o&&o.documentElement;e+=r.left-(a.clientLeft||i.clientLeft||0),n+=r.top-(a.clientTop||i.clientTop||0)}return{left:e,top:n}}function e(t){var e,n,r=t.getBoundingClientRect();return e=r.left+c.scrollLeft(),n=r.top+c.scrollTop(),{left:e,top:n}}function n(t,e,n){function r(){o?t[--o].call(null,e,r):n(e)}var o=t.length;r()}function r(t){return this instanceof r?this._init.call(this,t):new r(t)}var o=window,i=document,a=0,l=function(){},c=function(){function t(t){return function(e,n,r){r=r||0;var o=0,i=e.length;for(t>0?o=r>=0?r:Math.max(r+i,o):i=r>=0?Math.min(r+1,i):r+i+1,r=t>0?o:i-1;r>=0&&r<i;r+=t)if(e[r]===n)return r;return-1}}var e={},n=Object.prototype,r=n.toString,a=n.hasOwnProperty,l=Object.keys,c=Array.isArray;return e.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},e.isElement=function(t){return!(!t||1!==t.nodeType)},e.isArray=c||function(t){return"[object Array]"===r.call(t)},e.has=function(t,e){return null!==t&&a.call(t,e)},e.keys=function(t){if(!e.isObject)return[];l&&l(t);var n=[];for(var r in t)e.has(t,r)&&n.push(r);return n},e.extend=function(t,n){if(!n)return t;for(var r,o=e.keys(t),i=o.length;i--;)void 0!==n[r=o[i]]&&(t[r]=n[r]);return t},e.each=function(t,n,r){var o,i;if(e.isArray(t))for(o=0,i=t.length;o<i;o++)n.call(r,t[o],o,t);else{var a=e.keys(t);for(o=0,i=a.length;o<i;o++)n.call(r,t[a[o]],a[o],t)}return t},e.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(t){e["is"+t]=function(e){return r.call(e)==="[object "+t+"]"}}),e.isEmpty=function(t){return null===t||(e.isArray(t)||e.isString(t)?0===t.length:0===e.keys(t).length)},e.filter=function(t,n,r){var o=[];return e.each(t,function(t,e,i){n.call(r,t,e,i)&&o.push(t)}),o},e.now=Date.now||function(){return(new Date).getTime()},e.later=function(t,e,n,r){var o=setTimeout(function(){t.apply(n,r)},e);return{id:o,cancel:function(){clearTimeout(o)}}},e.buffer=function(t,n,r){function o(){o.stop(),i=e.later(t,n,r,arguments)}var i=null;return n=n||150,e.isString(t)&&(t=r[t]),o.stop=function(){i&&(i.cancel(),i=0)},o},e.throttle=function(t,n,r){function o(){o.stop(),i=e.now(),t.apply(r||this,arguments),a=e.now()}var i=0,a=0,l=null;return n=n||150,e.isString(t)&&(t=r[t]),o.stop=function(){l&&(l.cancel(),l=0)},function(){!i||a>=i&&e.now()-a>n||a<i&&e.now()-i>8*n?o():(l&&l.cancel(),l=e.later(o,n,r,arguments))}},e.indexOf=t(1),e.lastIndexOf=t(-1),e.isCross=function(t,e){var n={};return n.top=Math.max(t.top,e.top),n.bottom=Math.min(t.bottom,e.bottom),n.left=Math.max(t.left,e.left),n.right=Math.min(t.right,e.right),n.bottom>=n.top&&n.right>=n.left},e.scrollLeft=function(){return 1*(o.pageYOffset||0)+1*(i.documentElement.scrollLeft||0)+1*(i.body.scrollLeft||0)},e.scrollTop=function(){return 1*(o.pageXOffset||0)+1*(i.documentElement.scrollTop||0)+1*(i.body.scrollTop||0)},e.outerWidth=function(t){if(9===t.nodeType)return Math.max(document.documentElement.scrollWidth||0,o.innerWidth);var e=t.offsetWidth;return e>0?e:void 0},e.outerHeight=function(t){if(9===t.nodeType)return Math.max(document.documentElement.scrollHeight||0,o.innerHeight);var e=t.offsetHeight;return e>0?e:void 0},e.addClass=function(t,e){var n=t.className,r=n+(""!==n?" ":"")+e;t.className=r},e.removeClass=function(t,e){var n=" "+t.className+" ",r=(n=n.replace(/(\s+)/gi," ")).replace(" "+e+" "," ");r=r.replace(/(^\s+)|(\s+$)/g,""),t.className=r},e.hasClass=function(t,e){for(var n=t.className.split(/\s+/),r=n.length;r--;)if(n[r]===e)return!0;return!1},e}(window,document);r.prototype={constructor:r,_init:function(t){var e=this,n={attribute:"data-lazyload",lazyCls:"lib-lazyload",diff:100,autoDestroy:!0,duration:300,onStart:null};e.element=document,e.attribute=c.isString(t.attribute)?t.attribute:n.attribute,e.lazyCls=c.isString(t.lazyCls)?t.lazyCls:n.lazyCls,e.diff=void 0===t.diff?n.diff:t.diff,e.autoDestroy=void 0===t.autoDestroy?n.autoDestroy:t.autoDestroy,e.duration=c.isNumber(t.duration)&&t.duration>0?t.duration:n.duration,e.onStart=c.isFunction(t.onStart)?t.onStart:n.onStart,e._callbacks={},e._startListeners=[],e._initLoadEvent(),e.addElements(e.element),e._loadFn(),e.resume(),e._init=null},set:function(t,e){var n=this;c.isString(t)&&e&&(n[t]=e,"diff"!==t||c.isObject(e)||(n.diff={top:e,right:e,bottom:e,left:e}))},_getBoundingRect:function(t){var n,r,i,a,l=this.diff;if(void 0!==t){n=c.outerWidth(t),r=c.outerHeight(t);var s=e(t);i=s.left,a=s.top}else n=o.innerHeight,r=o.innerWidth,i=c.scrollLeft(),a=c.scrollTop();return c.isObject(l)||(l={top:l,right:l,bottom:l,left:l}),{left:i-(l.left||0),top:a-(l.top||0),right:i+r+(l.right||0),bottom:a+n+(l.bottom||0)}},_initLoadEvent:function(){var t=this,e=t.autoDestroy,r=t.duration,o=t.attribute;t.addStartListener(function(e,n){t.onStart&&t.onStart.apply(this,arguments),n&&n()}),t.imgHandle=function(){var e=this,r={type:"img",elem:e,src:e.getAttribute(o)};n(t._startListeners,r,function(n){e.removeAttribute(o),c.removeClass(e,t.lazyCls),n.src&&e.src!==n.src&&("IMG"===e.tagName?e.setAttribute("src",n.src):e.style.backgroundImage="url("+n.src+")")})},t._loadFn=c.throttle(function(){e&&c.isEmpty(t._callbacks)&&t.destroy(),t._loadItems()},r,t)},_loadItems:function(){var t=this,e=t._callbacks;c.each(e,function(e,n){e&&t._loadItem(n,e)})},_loadItem:function(t,e){var n=this;if(!(e=e||n._callbacks[t]))return!0;var r=e.el,o=e.fn,i=!1;if(n.__elementInViewport(r))try{i=o.call(r)}catch(t){setTimeout(function(){throw t},0)}return!1!==i&&delete n._callbacks[t],i},__elementInViewport:function(n){var r=this;if(!n.offsetWidth&&!n.offsetHeight)return!1;r.diff;var o=r._getBoundingRect(),i=e(n),a={left:i.left,top:i.top,right:i.left+n.offsetHeight,bottom:i.top+n.offsetWidth};return console.log(i),console.log(t(n)),c.isCross(o,a)},resume:function(){var t=this,e=t._loadFn;t._destroyed||(o.addEventListener("scroll",e,!1),o.addEventListener("touchmove",e,!1),o.addEventListener("resize",e,!1))},pause:function(){var t=this,e=t._loadFn;t._destroyed||(o.removeEventListener("scroll",e,!1),o.removeEventListener("touchmove",e,!1),o.removeEventListener("resize",e,!1))},destroy:function(){var t=this;t.pause(),t._callbacks={},t._destroyed=1},refresh:function(){this._loadFn()},addCallback:function(t,e){if(c.isElement(t)){var n=this,r=n._callbacks,o={el:t||i,fn:e||l},s=++a;return r[s]=o,n._loadItem(s,o),s}},removeCallback:function(t,e){if(c.isElement(t)){var n=this._callbacks;c.each(n,function(r,o){t===r.el&&(e?e===r.fn:1)&&delete n[o]})}},addElements:function(t){var e=this,n=e.attribute;c.isString(t)?t=i.querySelectorAll(t):!c.isArray(t)&&t.length?t=c.filter(t,function(t){return t}):c.isArray(t)||(t=[t]),c.each(t,function(t){if(t){var r=c.filter(t.querySelectorAll("."+e.lazyCls),function(t){return t});c.each(c.filter([t].concat(r),function(t){return t.getAttribute&&t.getAttribute(n)},e),function(t){e.addCallback(t,e.imgHandle)})}})},removeElements:function(t){var e=this._callbacks;c.isString(t)?t=i.querySelectorAll(t):!c.isArray(t)&&t.length?t=c.filter(t,function(t){return t}):c.isArray(t)||(t=[t]),c.each(e,function(n,r){-1!==c.indexOf(t,n.el)&&delete e[r]})},getElements:function(){var t=[],e=this._callbacks;return c.each(e,function(e){e.el&&t.push(e.el)}),t},addStartListener:function(t){var e=this._startListeners;t&&-1===c.indexOf(e,t)&&e.push(t)}};var s;return r.instance=function(){return s||(s=new r({autoDestroy:!1}))},r});