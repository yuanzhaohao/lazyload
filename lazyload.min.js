"use strict";(function(t,e){"use strict";if(typeof define==="function"&&define.amd){define([],e)}else if(typeof exports==="object"){module.exports=e()}else{t.Lazyload=e()}})(this,function(){var t=window;var e=document;var n=0;var r=function(){};var i=function(){var n={};var r=Object.prototype;var i=r.toString;var a=r.hasOwnProperty;var o=Object.keys;var l=Array.isArray;n.isObject=function(t){var e=typeof t;return e==="function"||e==="object"&&!!t};n.isElement=function(t){return!!(t&&t.nodeType===1)};n.isArray=l||function(t){return i.call(t)==="[object Array]"};n.has=function(t,e){return t!==null&&a.call(t,e)};n.keys=function(t){if(!n.isObject){return[]}if(o){o(t)}var e=[];for(var r in t){if(n.has(t,r)){e.push(r)}}return e};n.extend=function(t,e){if(!e){return t}var r=n.keys(t),i=r.length,a;while(i--){a=r[i];if(e[a]!==undefined){t[a]=e[a]}}return t};n.each=function(t,e,r){var i,a;if(n.isArray(t)){for(i=0,a=t.length;i<a;i++){e.call(r,t[i],i,t)}}else{var o=n.keys(t);for(i=0,a=o.length;i<a;i++){e.call(r,t[o[i]],o[i],t)}}return t};n.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(t){n["is"+t]=function(e){return i.call(e)==="[object "+t+"]"}});n.isEmpty=function(t){if(t===null){return true}if(n.isArray(t)||n.isString(t)){return t.length===0}return n.keys(t).length===0};n.filter=function(t,e,r){var i=[];n.each(t,function(t,n,a){if(e.call(r,t,n,a)){i.push(t)}});return i};n.now=Date.now||function(){return(new Date).getTime()};n.later=function(t,e,n,r){var i=function(){t.apply(n,r)},a=setTimeout(i,e);return{id:a,cancel:function(){clearTimeout(a)}}};n.buffer=function(t,e,r){var i=null;e=e||150;if(n.isString(t)){t=r[t]}function a(){a.stop();i=n.later(t,e,r,arguments)}a.stop=function(){if(i){i.cancel();i=0}};return a};n.throttle=function(t,e,r){var i=0,a=0,o=null;e=e||150;if(n.isString(t)){t=r[t]}function l(){l.stop();i=n.now();t.apply(r||this,arguments);a=n.now()}l.stop=function(){if(o){o.cancel();o=0}};return function(){if(!i||a>=i&&n.now()-a>e||a<i&&n.now()-i>e*8){l()}else{if(o){o.cancel()}o=n.later(l,e,r,arguments)}}};function s(t){return function(e,n,r){r=r||0;var i=0,a=e.length;if(t>0){i=r>=0?r:Math.max(r+a,i)}else{a=r>=0?Math.min(r+1,a):r+a+1}for(r=t>0?i:a-1;r>=0&&r<a;r+=t){if(e[r]===n){return r}}return-1}}n.indexOf=s(1);n.lastIndexOf=s(-1);n.isCross=function(t,e){var n={};n.top=Math.max(t.top,e.top);n.bottom=Math.min(t.bottom,e.bottom);n.left=Math.max(t.left,e.left);n.right=Math.min(t.right,e.right);return n.bottom>=n.top&&n.right>=n.left};n.scrollLeft=function(){return(t.pageYOffset||0)*1+(e.documentElement.scrollLeft||0)*1+(e.body.scrollLeft||0)*1};n.scrollTop=function(){return(t.pageXOffset||0)*1+(e.documentElement.scrollTop||0)*1+(e.body.scrollTop||0)*1};n.outerWidth=function(e){if(e.nodeType===9){return Math.max(document.documentElement.scrollWidth||0,t.innerWidth)}var n=e.offsetWidth;if(n>0){return n}};n.outerHeight=function(e){if(e.nodeType===9){return Math.max(document.documentElement.scrollHeight||0,t.innerHeight)}var n=e.offsetHeight;if(n>0){return n}};n.addClass=function(t,e){var n=t.className;var r=n!==""?" ":"";var i=n+r+e;t.className=i};n.removeClass=function(t,e){var n=" "+t.className+" ";n=n.replace(/(\s+)/gi," ");var r=n.replace(" "+e+" "," ");r=r.replace(/(^\s+)|(\s+$)/g,"");t.className=r};n.hasClass=function(t,e){var n=t.className.split(/\s+/);var r=n.length;while(r--){if(n[r]===e){return true}}return false};return n}(window,document,undefined);function a(t){var e=i.scrollLeft();var n=i.scrollTop();if(t.getBoundingClientRect){var r=t.getBoundingClientRect();var a=document;var o=a.body;var l=a&&a.documentElement;e+=r.left-(l.clientLeft||o.clientLeft||0);n+=r.top-(l.clientTop||o.clientTop||0)}return{left:e,top:n}}function o(t,e,n){var r=t.length;function i(){r?t[--r].call(null,e,i):n(e)}i()}function l(t){return this instanceof l?this._init.call(this,t):new l(t)}l.prototype={constructor:l,_init:function(t){var e=this;var n={attribute:"data-lazyload",lazyCls:"lib-lazyload",diff:100,autoDestroy:true,duration:300,onStart:null};e.element=document;e.attribute=i.isString(t.attribute)?t.attribute:n.attribute;e.lazyCls=i.isString(t.lazyCls)?t.lazyCls:n.lazyCls;e.diff=t.diff===undefined?n.diff:t.diff;e.autoDestroy=t.autoDestroy===undefined?n.autoDestroy:t.autoDestroy;e.duration=i.isNumber(t.duration)&&t.duration>0?t.duration:n.duration;e.onStart=i.isFunction(t.onStart)?t.onStart:n.onStart;e._callbacks={};e._startListeners=[];e._initLoadEvent();e.addElements(e.element);e._loadFn();e.resume();e._init=null},set:function(t,e){var n=this;if(i.isString(t)&&e){n[t]=e;if(t==="diff"&&!i.isObject(e)){n.diff={top:e,right:e,bottom:e,left:e}}}},_getBoundingRect:function(e){var n=this.diff;var r;var o;var l;var s;if(e!==undefined){r=i.outerWidth(e);o=i.outerHeight(e);var f=a(e);l=f.left;s=f.top}else{r=t.innerHeight;o=t.innerWidth;l=i.scrollLeft();s=i.scrollTop()}if(!i.isObject(n)){n={top:n,right:n,bottom:n,left:n}}return{left:l-(n.left||0),top:s-(n.top||0),right:l+o+(n.right||0),bottom:s+r+(n.bottom||0)}},_initLoadEvent:function(){var t=this,e=t.autoDestroy,n=t.duration,r=t.attribute;t.addStartListener(function(e,n){t.onStart&&t.onStart.apply(this,arguments);n&&n()});t.imgHandle=function(){var e=this;var n={type:"img",elem:e,src:e.getAttribute(r)};o(t._startListeners,n,function(n){e.removeAttribute(r);i.removeClass(e,t.lazyCls);if(n.src&&e.src!==n.src){if(e.tagName==="IMG"){e.setAttribute("src",n.src)}else{e.style.backgroundImage="url("+n.src+")"}}})};t._loadFn=i.throttle(function(){if(e&&i.isEmpty(t._callbacks)){t.destroy()}t._loadItems()},n,t)},_loadItems:function(){var t=this,e=t._callbacks;i.each(e,function(e,n){e&&t._loadItem(n,e)})},_loadItem:function(t,e){var n=this;e=e||n._callbacks[t];if(!e){return true}var r=e.el,i=e.fn,a=false;if(n.__elementInViewport(r)){try{a=i.call(r)}catch(o){setTimeout(function(){throw o},0)}}if(a!==false){delete n._callbacks[t]}return a},__elementInViewport:function(t){var e=this;if(!t.offsetWidth&&!t.offsetHeight){return false}var n=e.diff;var r=e._getBoundingRect();var o=a(t);var l={left:o.left,top:o.top,right:o.left+t.offsetHeight,bottom:o.top+t.offsetWidth};var s=i.isCross(r,l);return s},resume:function(){var e=this,n=e._loadFn;if(e._destroyed){return}t.addEventListener("scroll",n,false);t.addEventListener("touchmove",n,false);t.addEventListener("resize",n,false)},pause:function(){var e=this,n=e._loadFn;if(e._destroyed){return}t.removeEventListener("scroll",n,false);t.removeEventListener("touchmove",n,false);t.removeEventListener("resize",n,false)},destroy:function(){var t=this;t.pause();t._callbacks={};t._destroyed=1},refresh:function(){this._loadFn()},addCallback:function(t,a){if(!i.isElement(t)){return}var o=this,l=o._callbacks,s={el:t||e,fn:a||r},f=++n;l[f]=s;o._loadItem(f,s);return f},removeCallback:function(t,e){if(!i.isElement(t)){return}var n=this,r=n._callbacks;i.each(r,function(n,i){if(t===n.el&&(e?e===n.fn:1)){delete r[i]}})},addElements:function(t){var n=this,r=n.attribute;if(i.isString(t)){t=e.querySelectorAll(t)}else if(!i.isArray(t)&&t.length){t=i.filter(t,function(t){return t})}else if(!i.isArray(t)){t=[t]}i.each(t,function(t){if(!t){return}var e=i.filter(t.querySelectorAll("."+n.lazyCls),function(t){return t});i.each(i.filter([t].concat(e),function(t){return t.getAttribute&&t.getAttribute(r)},n),function(t){n.addCallback(t,n.imgHandle)})})},removeElements:function(t){var n=this,r=n._callbacks;if(i.isString(t)){t=e.querySelectorAll(t)}else if(!i.isArray(t)&&t.length){t=i.filter(t,function(t){return t})}else if(!i.isArray(t)){t=[t]}i.each(r,function(e,n){if(i.indexOf(t,e.el)!==-1){delete r[n]}})},getElements:function(){var t=this,e=[],n=t._callbacks;i.each(n,function(t){t.el&&e.push(t.el)});return e},addStartListener:function(t){var e=this,n=e._startListeners;if(!t||i.indexOf(n,t)!==-1){return}n.push(t)}};var s;l.instance=function(){return s||(s=new l({autoDestroy:false}))};return l});