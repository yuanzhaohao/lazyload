"use strict";!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.Lazyload=e()}(this,function(){function t(t){var e,n=0,r=0;return t!==i.body&&t!==i.documentElement&&t.getBoundingClientRect&&(n=(e=t.getBoundingClientRect()).left+l.scrollLeft(),r=e.top+l.scrollTop()),{left:n,top:r}}function e(t,e,n){function r(){i?t[--i].call(null,e,r):n(e)}var i=t.length;r()}function n(t){return this instanceof n?this._init.call(this,t):new n(t)}var r=window,i=document,o=0,a=function(){},l=function(){function t(t){return function(e,n,r){r=r||0;var i=0,o=e.length;for(t>0?i=r>=0?r:Math.max(r+o,i):o=r>=0?Math.min(r+1,o):r+o+1,r=t>0?i:o-1;r>=0&&r<o;r+=t)if(e[r]===n)return r;return-1}}var e={},n=Object.prototype,o=n.toString,a=n.hasOwnProperty,l=Object.keys,s=Array.isArray;return e.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},e.isElement=function(t){return!(!t||1!==t.nodeType)},e.isArray=s||function(t){return"[object Array]"===o.call(t)},e.has=function(t,e){return null!==t&&a.call(t,e)},e.keys=function(t){if(!e.isObject)return[];l&&l(t);var n=[];for(var r in t)e.has(t,r)&&n.push(r);return n},e.extend=function(t,n){if(!n)return t;for(var r,i=e.keys(t),o=i.length;o--;)void 0!==n[r=i[o]]&&(t[r]=n[r]);return t},e.each=function(t,n,r){var i,o;if(e.isArray(t))for(i=0,o=t.length;i<o;i++)n.call(r,t[i],i,t);else{var a=e.keys(t);for(i=0,o=a.length;i<o;i++)n.call(r,t[a[i]],a[i],t)}return t},e.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(t){e["is"+t]=function(e){return o.call(e)==="[object "+t+"]"}}),e.isEmpty=function(t){return null===t||(e.isArray(t)||e.isString(t)?0===t.length:0===e.keys(t).length)},e.filter=function(t,n,r){var i=[];return e.each(t,function(t,e,o){n.call(r,t,e,o)&&i.push(t)}),i},e.now=Date.now||function(){return(new Date).getTime()},e.later=function(t,e,n,r){var i=setTimeout(function(){t.apply(n,r)},e);return{id:i,cancel:function(){clearTimeout(i)}}},e.throttle=function(t,n,r){function i(){l&&(l.cancel(),l=0),o=e.now(),t.apply(r||this,arguments),a=e.now()}var o=0,a=0,l=null;return n=n||150,e.isString(t)&&(t=r[t]),function(){!o||a>=o&&e.now()-a>n||a<o&&e.now()-o>8*n?i():(l&&l.cancel(),l=e.later(i,n,r,arguments))}},e.indexOf=t(1),e.lastIndexOf=t(-1),e.isCross=function(t,e){var n={};return n.top=Math.max(t.top,e.top),n.bottom=Math.min(t.bottom,e.bottom),n.left=Math.max(t.left,e.left),n.right=Math.min(t.right,e.right),n.bottom>=n.top&&n.right>=n.left},e.scrollLeft=function(){return r.pageXOffset||i.documentElement.scrollLeft||i.body.scrollLeft},e.scrollTop=function(){return r.pageYOffset||i.documentElement.scrollTop||i.body.scrollTop},e.outerWidth=function(t){if(9===t.nodeType)return Math.max(document.documentElement.scrollWidth||0,r.innerWidth);var e=t.offsetWidth;return e>0?e:void 0},e.outerHeight=function(t){if(9===t.nodeType)return Math.max(document.documentElement.scrollHeight||0,r.innerHeight);var e=t.offsetHeight;return e>0?e:void 0},e.addClass=function(t,e){var n=t.className,r=n+(""!==n?" ":"")+e;t.className=r},e.removeClass=function(t,e){var n=" "+t.className+" ",r=(n=n.replace(/(\s+)/gi," ")).replace(" "+e+" "," ");r=r.replace(/(^\s+)|(\s+$)/g,""),t.className=r},e.hasClass=function(t,e){for(var n=t.className.split(/\s+/),r=n.length;r--;)if(n[r]===e)return!0;return!1},e}(window,document);n.prototype={constructor:n,_init:function(t){var e=this,n={attribute:"data-lazyload",lazyCls:"lib-lazyload",diff:100,autoDestroy:!0,duration:300,onStart:null};e.element=document,e.attribute=l.isString(t.attribute)?t.attribute:n.attribute,e.lazyCls=l.isString(t.lazyCls)?t.lazyCls:n.lazyCls,e.diff=void 0===t.diff?n.diff:t.diff,e.autoDestroy=void 0===t.autoDestroy?n.autoDestroy:t.autoDestroy,e.duration=l.isNumber(t.duration)&&t.duration>0?t.duration:n.duration,e.onStart=l.isFunction(t.onStart)?t.onStart:n.onStart,e._callbacks={},e._startListeners=[],e._initLoadEvent(),e.addElements(e.element),e._loadFn(),e.resume(),e._init=null},set:function(t,e){var n=this;l.isString(t)&&e&&(n[t]=e,"diff"!==t||l.isObject(e)||(n.diff={top:e,right:e,bottom:e,left:e}))},_getBoundingRect:function(e){var n,i,o,a,s=this.diff;if(void 0!==e){n=l.outerWidth(e),i=l.outerHeight(e);var u=t(e);o=u.left,a=u.top}else n=r.innerHeight,i=r.innerWidth,o=l.scrollLeft(),a=l.scrollTop();return l.isObject(s)||(s={top:s,right:s,bottom:s,left:s}),{left:o-(s.left||0),top:a-(s.top||0),right:o+i+(s.right||0),bottom:a+n+(s.bottom||0)}},_initLoadEvent:function(){var t=this,n=t.autoDestroy,r=t.duration,i=t.attribute;t.addStartListener(function(e,n){t.onStart&&t.onStart.apply(this,arguments),n&&n()}),t.imgHandle=function(){var n=this,r={type:"img",elem:n,src:n.getAttribute(i)};e(t._startListeners,r,function(e){n.removeAttribute(i),l.removeClass(n,t.lazyCls),e.src&&n.src!==e.src&&("IMG"===n.tagName?n.setAttribute("src",e.src):n.style.backgroundImage="url("+e.src+")")})},t._loadFn=l.throttle(function(){n&&l.isEmpty(t._callbacks)&&t.destroy(),t._loadItems()},r,t)},_loadItems:function(){var t=this,e=t._callbacks;l.each(e,function(e,n){e&&t._loadItem(n,e)})},_loadItem:function(t,e){var n=this;if(!(e=e||n._callbacks[t]))return!0;var r=e.el,i=e.fn,o=!1;if(n.__elementInViewport(r))try{o=i.call(r)}catch(t){setTimeout(function(){throw t},0)}return!1!==o&&delete n._callbacks[t],o},__elementInViewport:function(e){var n=this;if(!e.offsetWidth&&!e.offsetHeight)return!1;n.diff;var r=n._getBoundingRect(),i=t(e),o={left:i.left,top:i.top,right:i.left+e.offsetHeight,bottom:i.top+e.offsetWidth};return l.isCross(r,o)},resume:function(){var t=this,e=t._loadFn;t._destroyed||(r.addEventListener("scroll",e,!1),r.addEventListener("touchmove",e,!1),r.addEventListener("resize",e,!1))},pause:function(){var t=this,e=t._loadFn;t._destroyed||(r.removeEventListener("scroll",e,!1),r.removeEventListener("touchmove",e,!1),r.removeEventListener("resize",e,!1))},destroy:function(){var t=this;t.pause(),t._callbacks={},t._destroyed=1},refresh:function(){this._loadFn()},addCallback:function(t,e){if(l.isElement(t)){var n=this,r=n._callbacks,s={el:t||i,fn:e||a},u=++o;return r[u]=s,n._loadItem(u,s),u}},removeCallback:function(t,e){if(l.isElement(t)){var n=this._callbacks;l.each(n,function(r,i){t===r.el&&(e?e===r.fn:1)&&delete n[i]})}},addElements:function(t){var e=this,n=e.attribute;l.isString(t)?t=i.querySelectorAll(t):!l.isArray(t)&&t.length?t=l.filter(t,function(t){return t}):l.isArray(t)||(t=[t]),l.each(t,function(t){if(t){var r=l.filter(t.querySelectorAll("."+e.lazyCls),function(t){return t});l.each(l.filter([t].concat(r),function(t){return t.getAttribute&&t.getAttribute(n)},e),function(t){e.addCallback(t,e.imgHandle)})}})},removeElements:function(t){var e=this._callbacks;l.isString(t)?t=i.querySelectorAll(t):!l.isArray(t)&&t.length?t=l.filter(t,function(t){return t}):l.isArray(t)||(t=[t]),l.each(e,function(n,r){-1!==l.indexOf(t,n.el)&&delete e[r]})},getElements:function(){var t=[],e=this._callbacks;return l.each(e,function(e){e.el&&t.push(e.el)}),t},addStartListener:function(t){var e=this._startListeners;t&&-1===l.indexOf(e,t)&&e.push(t)}};var s;return n.instance=function(){return s||(s=new n({autoDestroy:!1}))},n});